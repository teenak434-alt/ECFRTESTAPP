# ECFR Application Architecture - Reading and Displaying Data

## Architecture Overview

```
???????????????????????????????????????????????????????????????????
?                         USER INTERFACE                          ?
???????????????????????????????????????????????????????????????????
?                                                                 ?
?  ????????????  ????????????  ????????????  ????????????      ?
?  ?   Home   ?  ?Dashboard ?  ?   Data   ?  ?Historical?      ?
?  ?  /Home/  ?  ?/Dashboard?  ?  Viewer  ?  ?/Dashboard?      ?
?  ?  Index   ?  ?  /Index  ?  ?/DataViewer? ?/Historical?     ?
?  ????????????  ????????????  ????????????  ????????????      ?
?       ?             ?              ?             ?             ?
?  ????????????  ????????????  ????????????  ????????????      ?
?  ? API Test ?  ?Checksums ?  ?  Debug   ?  ?Documents ?      ?
?  ? /Home/   ?  ?/Dashboard?  ?  /Debug/ ?  ?/DataViewer?     ?
?  ? ApiTest  ?  ?/Checksums?  ?  Index   ?  ?/Documents?      ?
?  ????????????  ????????????  ????????????  ????????????      ?
?       ?             ?              ?             ?             ?
??????????????????????????????????????????????????????????????????
        ?             ?              ?             ?
        ????????????????????????????????????????????
                      ?
        ?????????????????????????????
        ?    CONTROLLERS            ?
        ?????????????????????????????
        ?                           ?
        ?  ??????????????????????  ?
        ?  ? DashboardController?  ?
        ?  ??????????????????????  ?
        ?            ?              ?
        ?  ??????????????????????  ?
        ?  ?DataViewerController?  ?
        ?  ??????????????????????  ?
        ?            ?              ?
        ?  ??????????????????????  ?
        ?  ? ECFRDataController ?  ?  ? API Endpoints
        ?  ?    (REST API)      ?  ?
        ?  ??????????????????????  ?
        ?            ?              ?
        ?????????????????????????????
                     ?
        ?????????????????????????????
        ?      SERVICES             ?
        ?????????????????????????????
        ?                           ?
        ?  IFileStorageService      ?
        ?  ?? LoadDataAsync()       ?  ? Reads JSON files
        ?  ?? GetStatisticsAsync()  ?
        ?  ?? GetHistoricalAsync()  ?
        ?                           ?
        ?????????????????????????????
                     ?
        ?????????????????????????????
        ?      DATA FILES           ?
        ?????????????????????????????
        ?                           ?
        ?  ?? ecfr_current.json     ?
        ?     ?? FetchedAt          ?
        ?     ?? Documents[]        ?
        ?     ?? Statistics[]       ?
        ?                           ?
        ?  ?? ecfr_historical.json  ?
        ?     ?? HistoricalChange[] ?
        ?                           ?
        ?????????????????????????????
```

## Data Flow - Reading from Files

```
????????????????????????
?  User Action         ?
?  - Open page         ?
?  - Click API link    ?
?  - Call API endpoint ?
????????????????????????
           ?
           ?
????????????????????????
?  Controller          ?
?  - Receives request  ?
?  - Calls service     ?
????????????????????????
           ?
           ?
????????????????????????
?  FileStorageService  ?
?  - Reads JSON file   ?
?  - Deserializes data ?
?  - Returns objects   ?
????????????????????????
           ?
           ?
????????????????????????
?  JSON File           ?
?  Data/               ?
?  ?? ecfr_current     ?
?  ?? ecfr_historical  ?
????????????????????????
           ?
           ?
????????????????????????
?  Data Returned       ?
?  - Snapshot          ?
?  - Statistics        ?
?  - Historical        ?
????????????????????????
           ?
           ?
????????????????????????
?  Response            ?
?  - Razor View (HTML) ?
?  - JSON (API)        ?
????????????????????????
```

## API Endpoints Map

```
GET /api/ECFRData/snapshot
    ?
    ?? Calls: FileStorageService.LoadDataAsync()
    ?? Reads: Data/ecfr_current.json
    ?? Returns: Complete ECFRDataSnapshot
        ?? FetchedAt
        ?? Documents (100 items)
        ?? Statistics (agency stats)

GET /api/ECFRData/statistics
    ?
    ?? Calls: FileStorageService.GetAgencyStatisticsAsync()
    ?? Reads: Data/ecfr_current.json (Statistics section)
    ?? Returns: List<AgencyStatistics>
        ?? AgencyName, DocumentCount, Checksum

GET /api/ECFRData/historical
    ?
    ?? Calls: FileStorageService.GetHistoricalChangesAsync()
    ?? Reads: Data/ecfr_historical.json
    ?? Returns: List<HistoricalChange>
        ?? AgencyName, Date, DocumentCount
```

## UI Pages Data Source

```
????????????????????????????????????????????????????????
? Page                     Data Source                 ?
????????????????????????????????????????????????????????
? /Home/Index             Static HTML                  ?
? /Home/ApiTest           Calls APIs via JavaScript    ?
????????????????????????????????????????????????????????
? /Dashboard/Index        GET /api/ECFRData/statistics ?
? /Dashboard/Historical   GET /api/ECFRData/historical ?
? /Dashboard/Checksums    GET /api/ECFRData/statistics ?
????????????????????????????????????????????????????????
? /DataViewer/Index       FileStorageService (direct)  ?
? /DataViewer/Documents   FileStorageService (direct)  ?
????????????????????????????????????????????????????????
? /Debug/Index            Multiple sources (raw API,   ?
?                         parsed data, stored data)    ?
????????????????????????????????????????????????????????
```

## Data Models

```
ECFRDataSnapshot
?? FetchedAt: DateTime
?? Documents: List<ECFRDocument>
?  ?? ECFRDocument
?     ?? DocumentNumber: string?
?     ?? Title: string?
?     ?? AgencyName: string
?     ?? Type: string?
?     ?? PublicationDate: DateTime?
?     ?? Citation: string?
?     ?? Url: string?
?
?? Statistics: List<AgencyStatistics>
   ?? AgencyStatistics
      ?? AgencyName: string
      ?? DocumentCount: int
      ?? Checksum: string (SHA-256)
      ?? LastUpdated: DateTime

HistoricalChange
?? AgencyName: string
?? Date: DateTime
?? DocumentCount: int
```

## Service Methods

```
IFileStorageService
?
?? LoadDataAsync()
?  ?? Reads: Data/ecfr_current.json
?  ?? Returns: ECFRDataSnapshot?
?
?? GetAgencyStatisticsAsync()
?  ?? Calls: LoadDataAsync()
?  ?? Returns: List<AgencyStatistics> (from snapshot.Statistics)
?
?? GetHistoricalChangesAsync()
?  ?? Reads: Data/ecfr_historical.json
?  ?? Returns: List<HistoricalChange>
?
?? CalculateChecksum(string data)
   ?? Returns: SHA-256 hash
```

## Complete Request Flow Example

```
User opens: http://localhost:5000/DataViewer/Index
                    ?
                    ?
        DataViewerController.Index()
                    ?
                    ?
        _fileStorageService.LoadDataAsync()
                    ?
                    ?
        File.ReadAllTextAsync("Data/ecfr_current.json")
                    ?
                    ?
        JsonSerializer.Deserialize<ECFRDataSnapshot>(json)
                    ?
                    ?
        Return ECFRDataSnapshot to controller
                    ?
                    ?
        Pass to View(snapshot)
                    ?
                    ?
        Razor View renders HTML
                    ?
                    ?
        HTML returned to browser
                    ?
                    ?
        User sees:
        - Snapshot overview
        - Documents table (100 items)
        - Statistics table
        - Type breakdown chart
```

## File Locations

```
Project Root
?
??? Controllers/
?   ??? HomeController.cs           ? Renders home page
?   ??? DashboardController.cs      ? Renders dashboard views
?   ??? DataViewerController.cs     ? Renders data viewer (NEW)
?   ??? ECFRDataController.cs       ? REST API endpoints
?
??? Services/
?   ??? FileStorageService.cs       ? Reads JSON files
?
??? Views/
?   ??? Home/
?   ?   ??? Index.cshtml            ? Home page with links
?   ?   ??? ApiTest.cshtml          ? API testing page (NEW)
?   ??? Dashboard/
?   ?   ??? Index.cshtml            ? Statistics view
?   ?   ??? Historical.cshtml       ? Timeline charts
?   ?   ??? Checksums.cshtml        ? Checksum verification
?   ??? DataViewer/                 ? (NEW)
?   ?   ??? Index.cshtml            ? Complete data display
?   ?   ??? Documents.cshtml        ? All documents list
?   ??? Debug/
?       ??? Index.cshtml            ? Debug information
?
??? Data/                           ? Storage directory
    ??? ecfr_current.json          ? Current snapshot
    ??? ecfr_historical.json       ? Historical records
```

## Key Technologies

- **ASP.NET Core 10.0** - Web framework
- **C# 13** - Programming language
- **System.Text.Json** - JSON parsing
- **Bootstrap 5** - UI framework
- **Chart.js** - Charts and graphs
- **Razor Pages** - Server-side rendering

## Summary

? **Data is stored in JSON files**
? **FileStorageService reads the files**
? **Controllers expose the data via APIs and UI**
? **Multiple UI pages display the data**
? **All components are connected and working**
